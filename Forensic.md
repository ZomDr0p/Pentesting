# Volatility
###### Volatility is an open-source memory forensics framework for incident response and malware analysis. It is written in Python and supports Microsoft Windows, Mac OS X, and Linux. Volatility is one of the best open source software programs for analyzing RAM in 32 bit/64 bit systems.


Analysis can generally be accomplished in six steps:
1. Identify Rogue Processes
2. Analyze Process DLLs and Handles
3. Review Network Artifacts
4. Look for Evidence of Code Injection
5. Check for Signs of a Rootkit
6. Extract Processes, Drivers, and Objects

Good references:

	- Download: https://www.volatilityfoundation.org/releases
	- Github: https://github.com/volatilityfoundation/volatility
	- CheatSheet: https://digital-forensics.sans.org/media/volatility-memory-forensics-cheat-sheet.pdf
	- Wiki: https://www.aldeid.com/wiki/Volatility
	- Official Guide Volatility for Windows: https://github.com/volatilityfoundation/volatility/wiki/Installation#dependencies
	- Alternative Guide Volatility for Windows: https://dfironthemountain.wordpress.com/2018/10/29/installing-volatility-on-windows/
	- Large guide use of Volatility: https://resources.infosecinstitute.com/memory-forensics-and-analysis-using-volatility/
	- Analysis of RAM using Volatility infected with Cridex malware: https://medium.com/@zemelusa/first-steps-to-volatile-memory-analysis-dcbd4d2d56a1
	- Analysis with Volatility in Spanish part 1: https://byte-mind.net/analisis-forense-con-volatility/
	- Analysis with Volatility in Spanish part 1: https://byte-mind.net/cazando-malware-con-volatility/

	

## Command Lines

First we do **IMAGEINFO** to know which SO is the machine we are analysing to be able to set the profile correctly to continue with the analysis, also we will see how many processors the target machine has. 
This plugin is the one that takes the longest time to run because it is trying to determine the profile of the machine. 

```
root@kali20203:/home/user/Desktop# volatility -f memdump.mem imageinfo
Volatility Foundation Volatility Framework 2.6
INFO    : volatility.debug    : Determining profile based on KDBG search...
          Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418
                     AS Layer1 : WindowsAMD64PagedMemory (Kernel AS)
                     AS Layer2 : FileAddressSpace (/home/user/Desktop/memdump.mem)
                      PAE type : No PAE
                           DTB : 0x187000L
                          KDBG : 0xf80002bf5120L
          Number of Processors : 3
     Image Type (Service Pack) : 1
                KPCR for CPU 0 : 0xfffff80002bf7000L
                KPCR for CPU 1 : 0xfffff88002f00000L
                KPCR for CPU 2 : 0xfffff88002f7d000L
             KUSER_SHARED_DATA : 0xfffff78000000000L
           Image date and time : 2020-10-21 18:07:23 UTC+0000
     Image local date and time : 2020-10-21 20:07:23 +0200
```

With **PSLIST** we can see the processes that are running at the time of the memory dump. PID is the process identity, PPID is the parent process identity, OFFSET is the hexadecimal scrolling direction.

```
root@kali20203:/home/user/Desktop# volatility -f memdump.mem --profile=Win7SP1x64 pslist
Volatility Foundation Volatility Framework 2.6
Offset(V)          Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          
------------------ -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------
0xfffffa8020903040 System                    4      0     96      499 ------      0 2020-10-21 17:40:20 UTC+0000                                 
0xfffffa8021c43b00 smss.exe                280      4      2       31 ------      0 2020-10-21 17:40:20 UTC+0000                                 
0xfffffa8021930060 csrss.exe               368    352      9      401      0      0 2020-10-21 17:41:00 UTC+0000                                 
0xfffffa8022b6f420 csrss.exe               424    416     12      250      1      0 2020-10-21 17:41:09 UTC+0000                                 
0xfffffa8022b70890 wininit.exe             432    352      3       82      0      0 2020-10-21 17:41:09 UTC+0000                                 
0xfffffa8022bba060 services.exe            500    432      8      220      0      0 2020-10-21 17:41:13 UTC+0000                                 
0xfffffa8022bdf060 winlogon.exe            508    416      3      116      1      0 2020-10-21 17:41:13 UTC+0000                                 
0xfffffa8022be3b00 lsass.exe               520    432      7      583      0      0 2020-10-21 17:41:14 UTC+0000                                 
0xfffffa8022bf49a0 lsm.exe                 532    432      9      144      0      0 2020-10-21 17:41:14 UTC+0000                                 
0xfffffa8022c926a0 svchost.exe             644    500      9      362      0      0 2020-10-21 17:41:25 UTC+0000                                 
0xfffffa8022c87450 svchost.exe             724    500      7      265      0      0 2020-10-21 17:41:27 UTC+0000                                 
0xfffffa8022cc7b00 svchost.exe             804    500     20      468      0      0 2020-10-21 17:41:30 UTC+0000                                 
0xfffffa8022cf5260 svchost.exe             852    500     17      440      0      0 2020-10-21 17:41:33 UTC+0000                                 
0xfffffa8022d15060 svchost.exe             880    500     14      556      0      0 2020-10-21 17:41:33 UTC+0000                                 
0xfffffa8022d1d060 svchost.exe             904    500     33      916      0      0 2020-10-21 17:41:33 UTC+0000                                 
0xfffffa8022db8b00 svchost.exe             740    500     14      475      0      0 2020-10-21 17:41:52 UTC+0000                                 
0xfffffa8022eb3b00 spoolsv.exe            1240    500     13      286      0      0 2020-10-21 17:42:04 UTC+0000                                 
0xfffffa8022ebc8f0 svchost.exe            1268    500     19      319      0      0 2020-10-21 17:42:04 UTC+0000                                 
0xfffffa8021ff1950 svchost.exe            1372    500     10      154      0      0 2020-10-21 17:42:11 UTC+0000                                 
0xfffffa8022cf6890 VGAuthService.         1504    500      3       89      0      0 2020-10-21 17:42:31 UTC+0000                                 
0xfffffa8020a6bb00 taskhost.exe           1660    500      9      245      1      0 2020-10-21 17:42:48 UTC+0000                                 
0xfffffa8022fbcb00 dwm.exe                1668    852      5      154      1      0 2020-10-21 17:42:50 UTC+0000                                 
0xfffffa8022fc0b00 explorer.exe           1676   1652     25     1024      1      0 2020-10-21 17:42:50 UTC+0000                                 
0xfffffa80230098f0 vmtoolsd.exe           1784    500     11      295      0      0 2020-10-21 17:42:54 UTC+0000                                 
0xfffffa802310d8e0 svchost.exe            1156    500      6       96      0      0 2020-10-21 17:43:23 UTC+0000                                 
0xfffffa8022006b00 dllhost.exe             376    500     13      196      0      0 2020-10-21 17:43:29 UTC+0000                                 
0xfffffa802311fb00 WmiPrvSE.exe           2068    644     10      219      0      0 2020-10-21 17:43:31 UTC+0000                                 
0xfffffa8023121b00 msdtc.exe              2076    500     12      148      0      0 2020-10-21 17:43:31 UTC+0000                                 
0xfffffa8020b272d0 vm3dservice.ex         2176   1676      2       50      1      0 2020-10-21 17:43:36 UTC+0000                                 
0xfffffa8020b37b00 vmtoolsd.exe           2188   1676      8      185      1      0 2020-10-21 17:43:36 UTC+0000                                 
0xfffffa8020afab00 SearchIndexer.         2508    500     12      574      0      0 2020-10-21 17:43:45 UTC+0000                                 
0xfffffa8020d5bb00 sppsvc.exe             2996    500      4      151      0      0 2020-10-21 17:45:31 UTC+0000                                 
0xfffffa80220efb00 svchost.exe             668    500     13      348      0      0 2020-10-21 17:45:32 UTC+0000                                 
0xfffffa8020dab680 FTK Imager.exe         2912   1676     13      333      1      1 2020-10-21 17:46:28 UTC+0000                                 
0xfffffa80212483c0 malvado.exe            2972   1676      3       99      1      1 2020-10-21 18:05:07 UTC+0000                                 
0xfffffa8021075200 cmd.exe                2428   1676      1       22      1      0 2020-10-21 18:05:49 UTC+0000                                 
0xfffffa802124eb00 conhost.exe            2672    424      2       53      1      0 2020-10-21 18:05:49 UTC+0000                                 
0xfffffa802124a060 taskmgr.exe            1436   1676      6      123      1      0 2020-10-21 18:10:24 UTC+0000                                 
0xfffffa8020c36790 svchost.exe             836    500      0 --------      0      0 2020-10-21 18:12:53 UTC+0000   2020-10-21 18:15:03 UTC+0000  
```

**PSTREE** also shows the processes that were running on the machine at the time of the break-in, but in a hierarchical tree format. 

```

root@kali20203:/home/user/Desktop# volatility -f memdump.mem --profile=Win7SP1x64 pstree
Volatility Foundation Volatility Framework 2.6
Name                                                  Pid   PPid   Thds   Hnds Time
-------------------------------------------------- ------ ------ ------ ------ ----
 0xfffffa8022fc0b00:explorer.exe                     1676   1652     25   1024 2020-10-21 17:42:50 UTC+0000
. 0xfffffa8020b272d0:vm3dservice.ex                  2176   1676      2     50 2020-10-21 17:43:36 UTC+0000
. 0xfffffa80212483c0:malvado.exe                     2972   1676      3     99 2020-10-21 18:05:07 UTC+0000
. 0xfffffa8020dab680:FTK Imager.exe                  2912   1676     13    333 2020-10-21 17:46:28 UTC+0000
. 0xfffffa8020b37b00:vmtoolsd.exe                    2188   1676      8    185 2020-10-21 17:43:36 UTC+0000
. 0xfffffa8021075200:cmd.exe                         2428   1676      1     22 2020-10-21 18:05:49 UTC+0000
. 0xfffffa802124a060:taskmgr.exe                     1436   1676      6    123 2020-10-21 18:10:24 UTC+0000
 0xfffffa8020903040:System                              4      0     96    499 2020-10-21 17:40:20 UTC+0000
. 0xfffffa8021c43b00:smss.exe                         280      4      2     31 2020-10-21 17:40:20 UTC+0000
 0xfffffa8021930060:csrss.exe                         368    352      9    401 2020-10-21 17:41:00 UTC+0000
 0xfffffa8022b70890:wininit.exe                       432    352      3     82 2020-10-21 17:41:09 UTC+0000
. 0xfffffa8022be3b00:lsass.exe                        520    432      7    583 2020-10-21 17:41:14 UTC+0000
. 0xfffffa8022bf49a0:lsm.exe                          532    432      9    144 2020-10-21 17:41:14 UTC+0000
. 0xfffffa8022bba060:services.exe                     500    432      8    220 2020-10-21 17:41:13 UTC+0000
.. 0xfffffa8022c926a0:svchost.exe                     644    500      9    362 2020-10-21 17:41:25 UTC+0000
... 0xfffffa802311fb00:WmiPrvSE.exe                  2068    644     10    219 2020-10-21 17:43:31 UTC+0000
.. 0xfffffa8023121b00:msdtc.exe                      2076    500     12    148 2020-10-21 17:43:31 UTC+0000
.. 0xfffffa802310d8e0:svchost.exe                    1156    500      6     96 2020-10-21 17:43:23 UTC+0000
.. 0xfffffa8022cc7b00:svchost.exe                     804    500     20    468 2020-10-21 17:41:30 UTC+0000
.. 0xfffffa80220efb00:svchost.exe                     668    500     13    348 2020-10-21 17:45:32 UTC+0000
.. 0xfffffa8022d1d060:svchost.exe                     904    500     33    916 2020-10-21 17:41:33 UTC+0000
.. 0xfffffa8020d5bb00:sppsvc.exe                     2996    500      4    151 2020-10-21 17:45:31 UTC+0000
.. 0xfffffa8020c36790:svchost.exe                     836    500      0 ------ 2020-10-21 18:12:53 UTC+0000
.. 0xfffffa8020afab00:SearchIndexer.                 2508    500     12    574 2020-10-21 17:43:45 UTC+0000
.. 0xfffffa8022006b00:dllhost.exe                     376    500     13    196 2020-10-21 17:43:29 UTC+0000
.. 0xfffffa8022c87450:svchost.exe                     724    500      7    265 2020-10-21 17:41:27 UTC+0000
.. 0xfffffa8022eb3b00:spoolsv.exe                    1240    500     13    286 2020-10-21 17:42:04 UTC+0000
.. 0xfffffa8021ff1950:svchost.exe                    1372    500     10    154 2020-10-21 17:42:11 UTC+0000
.. 0xfffffa8022cf6890:VGAuthService.                 1504    500      3     89 2020-10-21 17:42:31 UTC+0000
.. 0xfffffa8022db8b00:svchost.exe                     740    500     14    475 2020-10-21 17:41:52 UTC+0000
.. 0xfffffa8022d15060:svchost.exe                     880    500     14    556 2020-10-21 17:41:33 UTC+0000
.. 0xfffffa8022ebc8f0:svchost.exe                    1268    500     19    319 2020-10-21 17:42:04 UTC+0000
.. 0xfffffa80230098f0:vmtoolsd.exe                   1784    500     11    295 2020-10-21 17:42:54 UTC+0000
.. 0xfffffa8022cf5260:svchost.exe                     852    500     17    440 2020-10-21 17:41:33 UTC+0000
... 0xfffffa8022fbcb00:dwm.exe                       1668    852      5    154 2020-10-21 17:42:50 UTC+0000
.. 0xfffffa8020a6bb00:taskhost.exe                   1660    500      9    245 2020-10-21 17:42:48 UTC+0000
 0xfffffa8022b6f420:csrss.exe                         424    416     12    250 2020-10-21 17:41:09 UTC+0000
. 0xfffffa802124eb00:conhost.exe                     2672    424      2     53 2020-10-21 18:05:49 UTC+0000
 0xfffffa8022bdf060:winlogon.exe                      508    416      3    116 2020-10-21 17:41:13 UTC+0000

```

With **PSXVIEW**  all the processes that are tried to be hidden will be listed, notice in which columns the value "False" appears the most relevant are pslist and psscan


```

root@kali20203:/home/user/Desktop# volatility -f memdump.mem --profile=Win7SP1x64 psxview
Volatility Foundation Volatility Framework 2.6
Offset(P)          Name                    PID pslist psscan thrdproc pspcid csrss session deskthrd ExitTime
------------------ -------------------- ------ ------ ------ -------- ------ ----- ------- -------- --------
0x00000000a895bb00 sppsvc.exe             2996 True   False  False    True   True  True    False    
0x00000000a74efb00 svchost.exe             668 True   False  False    True   True  True    False    
0x00000000a8a6bb00 taskhost.exe           1660 True   False  False    True   True  True    False    
0x00000000a650d8e0 svchost.exe            1156 True   False  False    True   True  True    False    
0x00000000a68f6890 VGAuthService.         1504 True   False  False    True   True  True    True     
0x00000000a824eb00 conhost.exe            2672 True   False  False    True   True  True    False    
0x00000000a824a060 taskmgr.exe            1436 True   False  False    True   True  True    False    
0x00000000a6bf49a0 lsm.exe                 532 True   False  False    True   True  True    False    
0x00000000a66bc8f0 svchost.exe            1268 True   False  False    True   True  True    False    
0x00000000a66b3b00 spoolsv.exe            1240 True   False  False    True   True  True    True     
0x00000000a77f1950 svchost.exe            1372 True   False  False    True   True  True    True     
0x00000000a8b37b00 vmtoolsd.exe           2188 True   False  False    True   True  True    True     
0x00000000a67c0b00 explorer.exe           1676 True   False  False    True   True  True    True     
0x00000000a67bcb00 dwm.exe                1668 True   False  False    True   True  True    False    
0x00000000a89ab680 FTK Imager.exe         2912 True   False  False    True   True  True    False    
0x00000000a82483c0 malvado.exe            2972 True   False  False    True   True  True    False    
0x00000000a691d060 svchost.exe             904 True   False  False    True   True  True    True     
0x00000000a8475200 cmd.exe                2428 True   False  False    True   True  True    False    
0x00000000a8afab00 SearchIndexer.         2508 True   False  False    True   True  True    True     

```


With **SVCSCAN** to be able to see the services that were active on the machine when the dumper was made. It gives information such as the OFFSET, when this process will start, the current status of the service, name, description and how that service is running. 

```
root@kali20203:/home/user/Desktop# volatility -f memdump.mem --profile=Win7SP1x64 svcscan | more
Volatility Foundation Volatility Framework 2.6
Offset: 0xce3690
Order: 71
Start: SERVICE_AUTO_START
Process ID: 644
Service Name: DcomLaunch
Display Name: DCOM Server Process Launcher
Service Type: SERVICE_WIN32_SHARE_PROCESS
Service State: SERVICE_RUNNING
Binary Path: C:\Windows\system32\svchost.exe -k DcomLaunch

Offset: 0xce35a0
Order: 70
Start: SERVICE_DEMAND_START
Process ID: -
Service Name: dc21x4vm
Display Name: dc21x4vm
Service Type: SERVICE_KERNEL_DRIVER
Service State: SERVICE_STOPPED
Binary Path: -

Offset: 0xce34b0
Order: 69
Start: SERVICE_AUTO_START
Process ID: 852
Service Name: CscService
Display Name: Offline Files
Service Type: SERVICE_WIN32_SHARE_PROCESS
Service State: SERVICE_RUNNING
Binary Path: C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted
--More--

```

We may use **grep** to look for something more specific that might give us information that a service has been hijacked. 

```

root@kali20203:/home/user/Desktop# volatility -f memdump.mem --profile=Win7SP1x64 svcscan | grep -i "Binary Path:" | grep -v "Binary Path: -"
Volatility Foundation Volatility Framework 2.6
Binary Path: C:\Windows\system32\svchost.exe -k DcomLaunch
Binary Path: C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted
Binary Path: \Driver\CSC
Binary Path: C:\Windows\system32\svchost.exe -k NetworkService
Binary Path: C:\Windows\system32\dllhost.exe /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235}
Binary Path: \Driver\Compbatt
Binary Path: \Driver\CNG
Binary Path: \Driver\CLFS
Binary Path: \Driver\cdrom
Binary Path: C:\Windows\system32\svchost.exe -k bthsvcs
Binary Path: \FileSystem\bowser
Binary Path: \Driver\blbdrive
Binary Path: C:\Windows\system32\svchost.exe -k LocalServiceNoNetwork

```

With **DLLLIST** we can see that all the dll files of all the processes executed at that time by the User and the Operate System 


```
root@kali20203:/home/user/Desktop# volatility --profile=Win7SP1x64 -f memdump.mem dlllist | more
Volatility Foundation Volatility Framework 2.6
************************************************************************
System pid:      4
Unable to read PEB for task.
************************************************************************
smss.exe pid:    280
Command line : \SystemRoot\System32\smss.exe


Base                             Size          LoadCount LoadTime                       Path
------------------ ------------------ ------------------ ------------------------------ ----
0x0000000047a50000            0x20000             0xffff 1970-01-01 00:00:00 UTC+0000   \SystemRoot\System32\smss.exe
0x0000000077430000           0x19f000             0xffff 1970-01-01 00:00:00 UTC+0000   C:\Windows\SYSTEM32\ntdll.dll
************************************************************************
csrss.exe pid:    368
Command line : %SystemRoot%\system32\csrss.exe ObjectDirectory=\Windows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=basesrv,1 Serve
rDll=winsrv:UserServerDllInitialization,3 ServerDll=winsrv:ConServerDllInitialization,2 ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16
Service Pack 1

```

Since **DLLLIST** will display a large list you can also specify the PID you are looking for

```

root@kali20203:/home/user/Desktop# volatility --profile=Win7SP1x64 -f memdump.mem dlllist -p 2972
Volatility Foundation Volatility Framework 2.6
************************************************************************
malvado.exe pid:   2972
Command line : "C:\Users\user\Desktop\malvado.exe" 


Base                             Size          LoadCount LoadTime                       Path
------------------ ------------------ ------------------ ------------------------------ ----
0x0000000000400000            0x16000             0xffff 1970-01-01 00:00:00 UTC+0000   C:\Users\user\Desktop\malvado.exe
0x0000000077430000           0x19f000             0xffff 1970-01-01 00:00:00 UTC+0000   C:\Windows\SYSTEM32\ntdll.dll
0x0000000074750000            0x3f000                0x3 2020-10-21 18:05:07 UTC+0000   C:\Windows\SYSTEM32\wow64.dll
0x00000000746f0000            0x5c000                0x1 2020-10-21 18:05:07 UTC+0000   C:\Windows\SYSTEM32\wow64win.dll
0x0000000074bb0000             0x8000                0x1 2020-10-21 18:05:07 UTC+0000   C:\Windows\SYSTEM32\wow64cpu.dll
0x0000000000400000            0x16000             0xffff 1970-01-01 00:00:00 UTC+0000   C:\Users\user\Desktop\malvado.exe
0x00000000775f0000           0x180000             0xffff 1970-01-01 00:00:00 UTC+0000   C:\Windows\SysWOW64\ntdll.dll
0x0000000075620000           0x110000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\kernel32.dll
0x0000000076190000            0x47000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\KERNELBASE.dll
0x0000000076510000            0xac000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\MSVCRT.dll
0x0000000075570000            0xa1000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\ADVAPI32.dll
0x00000000753f0000            0x19000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\SysWOW64\sechost.dll
0x0000000074dc0000            0xf0000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\RPCRT4.dll
0x0000000074d60000            0x60000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\SspiCli.dll
0x0000000074d50000             0xc000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\CRYPTBASE.dll
0x0000000074140000             0x7000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\system32\WSOCK32.dll
0x00000000764d0000            0x35000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\WS2_32.dll
0x0000000075730000             0x6000             0xffff 2020-10-21 18:05:07 UTC+0000   C:\Windows\syswow64\NSI.dll
0x000000006fe40000            0x3c000                0x2 2020-10-21 18:05:08 UTC+0000   C:\Windows\system32\mswsock.dll
0x0000000076260000           0x100000               0xb1 2020-10-21 18:05:08 UTC+0000   C:\Windows\syswow64\user32.dll

```

With **DLLDUMP** we can extract all the files and save them in a folder

```


root@kali20203:/home/user/Desktop# volatility --profile=Win7SP1x64 -f memdump.mem dlldump -D /home/user/Desktop/dll_dump/
Volatility Foundation Volatility Framework 2.6
Process(V)         Name                 Module Base        Module Name          Result
------------------ -------------------- ------------------ -------------------- ------
0xfffffa8021c43b00 smss.exe             0x0000000047a50000 smss.exe             OK: module.280.a7843b00.47a50000.dll
0xfffffa8021c43b00 smss.exe             0x0000000077430000 ntdll.dll            OK: module.280.a7843b00.77430000.dll
0xfffffa8021930060 csrss.exe            0x0000000049dd0000 csrss.exe            OK: module.368.a7d30060.49dd0000.dll
0xfffffa8021930060 csrss.exe            0x0000000077430000 ntdll.dll            OK: module.368.a7d30060.77430000.dll
0xfffffa8021930060 csrss.exe            0x000007fefcf40000 sxssrv.DLL           OK: module.368.a7d30060.7fefcf40000.dll
0xfffffa8021930060 csrss.exe            0x0000000077330000 USER32.dll           OK: module.368.a7d30060.77330000.dll
0xfffffa8021930060 csrss.exe            0x000007fefe5f0000 LPK.dll              OK: module.368.a7d30060.7fefe5f0000.dll
0xfffffa8021930060 csrss.exe            0x000007feff070000 msvcrt.dll           OK: module.368.a7d30060.7feff070000.dll
0xfffffa8021930060 csrss.exe            0x000007fefce80000 sxs.dll              OK: module.368.a7d30060.7fefce80000.dll
0xfffffa8021930060 csrss.exe            0x000007fefcf90000 basesrv.DLL          OK: module.368.a7d30060.7fefcf90000.dll
0xfffffa8021930060 csrss.exe            0x000007fefee20000 RPCRT4.dll           OK: module.368.a7d30060.7fefee20000.dll
0xfffffa8021930060 csrss.exe            0x000007fefce70000 CRYPTBASE.dll        OK: module.368.a7d30060.7fefce70000.dll
0xfffffa8021930060 csrss.exe            0x000007fefcfb0000 CSRSRV.dll           OK: module.368.a7d30060.7fefcfb0000.dll
0xfffffa8021930060 csrss.exe            0x000007feff1c0000 USP10.dll            OK: module.368.a7d30060.7feff1c0000.dll
0xfffffa8021930060 csrss.exe            0x000007fefd120000 KERNELBASE.dll       OK: module.368.a7d30060.7fefd120000.dll
0xfffffa8021930060 csrss.exe            0x000007fefd390000 GDI32.dll            OK: module.368.a7d30060.7fefd390000.dll
0xfffffa8021930060 csrss.exe            0x0000000077210000 kernel32.dll         OK: module.368.a7d30060.77210000.dll
0xfffffa8021930060 csrss.exe            0x000007fefcf50000 winsrv.DLL           OK: module.368.a7d30060.7fefcf50000.dll
0xfffffa8022b6f420 csrss.exe            0x0000000049dd0000 csrss.exe            OK: module.424.a6b6f420.49dd0000.dll
0xfffffa8022b6f420 csrss.exe            0x0000000077430000 ntdll.dll            OK: module.424.a6b6f420.77430000.dll
0xfffffa8022b6f420 csrss.exe            0x000007fefcf40000 sxssrv.DLL           OK: module.424.a6b6f420.7fefcf40000.dll
0xfffffa8022b6f420 csrss.exe            0x0000000077330000 USER32.dll           OK: module.424.a6b6f420.77330000.dll
0xfffffa8022b6f420 csrss.exe            0x000007fefe5f0000 LPK.dll              OK: module.424.a6b6f420.7fefe5f0000.dll
0xfffffa8022b6f420 csrss.exe            0x000007feff070000 msvcrt.dll           OK: module.424.a6b6f420.7feff070000.dll

```

To be able to review Network Artifacts we are going to use the plug-in **NETSCAN** which is going to scan a Windows Vista (or later Windows OS) image for connections and sockets. We can also use **SOCKETS** that print a list of open sockets and **CONNSCAN** that list TCP connections


```

root@kali20203:/home/user/Desktop# volatility -f memdump.mem --profile=Win7SP1x64 netscan
Volatility Foundation Volatility Framework 2.6
Offset(P)          Proto    Local Address                  Foreign Address      State            Pid      Owner          Created
0xa6989630         UDPv4    0.0.0.0:5355                   *:*                                   740      svchost.exe    2020-10-21 18:12:01 UTC+0000
0xa6989630         UDPv6    :::5355                        *:*                                   740      svchost.exe    2020-10-21 18:12:01 UTC+0000
0xa69bd370         UDPv4    192.168.52.139:138             *:*                                   4        System         2020-10-21 17:41:55 UTC+0000
0xa6b55010         UDPv4    0.0.0.0:0                      *:*                                   740      svchost.exe    2020-10-21 17:41:55 UTC+0000
0xa6b55010         UDPv6    :::0                           *:*                                   740      svchost.exe    2020-10-21 17:41:55 UTC+0000
0xa6b55350         UDPv4    192.168.52.139:137             *:*                                   4        System         2020-10-21 17:41:55 UTC+0000
0xa64a6ee0         TCPv4    0.0.0.0:49156                  0.0.0.0:0            LISTENING        500      services.exe   
0xa6654e00         TCPv4    0.0.0.0:49156                  0.0.0.0:0            LISTENING        500      services.exe   
0xa6654e00         TCPv6    :::49156                       :::0                 LISTENING        500      services.exe   
0xa6693d90         TCPv4    0.0.0.0:49155                  0.0.0.0:0            LISTENING        904      svchost.exe    
0xa6693d90         TCPv6    :::49155                       :::0                 LISTENING        904      svchost.exe    
0xa67dbdf0         TCPv4    0.0.0.0:445                    0.0.0.0:0            LISTENING        4        System         
0xa67dbdf0         TCPv6    :::445                         :::0                 LISTENING        4        System         
0xa68acee0         TCPv4    0.0.0.0:135                    0.0.0.0:0            LISTENING        724      svchost.exe    
0xa68acee0         TCPv6    :::135                         :::0                 LISTENING        724      svchost.exe    
0xa68b33b0         TCPv4    0.0.0.0:49152                  0.0.0.0:0            LISTENING        432      wininit.exe    
0xa68bbba0         TCPv4    0.0.0.0:135                    0.0.0.0:0            LISTENING        724      svchost.exe    
0xa68f3ee0         TCPv4    0.0.0.0:49153                  0.0.0.0:0            LISTENING        804      svchost.exe    
0xa68f3ee0         TCPv6    :::49153                       :::0                 LISTENING        804      svchost.exe    
0xa68f42b0         TCPv4    0.0.0.0:49153                  0.0.0.0:0            LISTENING        804      svchost.exe    
0xa6900180         TCPv4    0.0.0.0:49154                  0.0.0.0:0            LISTENING        520      lsass.exe      
0xa6900180         TCPv6    :::49154                       :::0                 LISTENING        520      lsass.exe      
0xa6941640         TCPv4    0.0.0.0:49154                  0.0.0.0:0            LISTENING        520      lsass.exe      
0xa69c4010         TCPv4    0.0.0.0:49155                  0.0.0.0:0            LISTENING        904      svchost.exe    
0xa6b3b600         TCPv4    192.168.52.139:139             0.0.0.0:0            LISTENING        4        System         
0xa6bab970         TCPv4    0.0.0.0:49152                  0.0.0.0:0            LISTENING        432      wininit.exe    
0xa6bab970         TCPv6    :::49152                       :::0                 LISTENING        432      wininit.exe    
0xa6b76730         TCPv4    192.168.52.139:49161           192.168.52.134:51632 ESTABLISHED      -1                      
0xa8458370         UDPv4    0.0.0.0:5355                   *:*                                   740      svchost.exe    2020-10-21 18:12:01 UTC+0000
0xa849f8f0         UDPv6    fe80::fce6:adb:371d:37a8:546   *:*                                   804      svchost.exe    2020-10-21 18:10:26 UTC+0000
0xa88751d0         UDPv6    fe80::fce6:adb:371d:37a8:546   *:*                                   804      svchost.exe    2020-10-21 18:17:35 UTC+0000
0xa8d4cc10         UDPv4    0.0.0.0:0                      *:*                                   904      svchost.exe    2020-10-21 18:18:47 UTC+0000
0xa8d4cc10         UDPv6    :::0                           *:*                                   904      svchost.exe    2020-10-21 18:18:47 UTC+0000

```

We use **HIVELIST** to view the Hive Records, these are a group of records that are loaded into memory when the OS starts or a user logs in. This is important because by having the SAM and SYSTEM files identified we can perform a dump and get the users and hashes of the users that were logged in on that machine:

- https://docs.microsoft.com/es-es/windows/win32/sysinfo/registry-hives?redirectedfrom=MSDN

```

root@kali20203:/home/user/Desktop# volatility -f memdump.mem --profile=Win7SP1x64 hivelist
Volatility Foundation Volatility Framework 2.6
Virtual            Physical           Name
------------------ ------------------ ----
0xfffff8a00441d010 0x000000005239a010 \SystemRoot\System32\Config\SECURITY
0xfffff8a00442d010 0x00000000524ab010 \SystemRoot\System32\Config\DEFAULT
0xfffff8a004430010 0x00000000526ae010 \SystemRoot\System32\Config\SAM
0xfffff8a00445e010 0x00000000425b8010 \??\C:\Windows\ServiceProfiles\LocalService\NTUSER.DAT
0xfffff8a00000f010 0x0000000055084010 [no name]
0xfffff8a000024010 0x000000005508f010 \REGISTRY\MACHINE\SYSTEM
0xfffff8a000058010 0x0000000054fc3010 \REGISTRY\MACHINE\HARDWARE
0xfffff8a00060c010 0x0000000052974010 \Device\HarddiskVolume1\Boot\BCD
0xfffff8a00061f010 0x0000000052439010 \SystemRoot\System32\Config\SOFTWARE
0xfffff8a001080010 0x0000000041e08010 \??\C:\Windows\ServiceProfiles\NetworkService\NTUSER.DAT
0xfffff8a001666010 0x0000000035b06010 \??\C:\Users\user\ntuser.dat
0xfffff8a001675010 0x000000004139a010 \??\C:\Users\user\AppData\Local\Microsoft\Windows\UsrClass.dat

```

With **HASHDUMP**, take note of the virtual values, we will now proceed to dump SAM with the argument -s and SYSTEM with -y. As a result we will be given the username and NTLM hash of that account

```

root@kali20203:/home/user/Desktop# volatility hashdump --profile=Win7SP1x64 -f memdump.mem -s 0xfffff8a00445e010 -y 0xfffff8a00441d010 
Volatility Foundation Volatility Framework 2.6
Administrador:500:e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c:::
usuariobasico:1125:5c56109436004859ebd85531b8d5539f:1bfd3d3e4d9b85290d000fe25714b487:::

```

Also with **HASHDUMP** you don't need to point out the OFFSETS of the SAM and SYSTEM to dump the NTLM hashes

```

root@kali20203:/home/user/Desktop# volatility --profile=Win7SP1x64 -f memdump.mem hashdump
Volatility Foundation Volatility Framework 2.6
Administrador:500:e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c:::
usuariobasico:1125:5c56109436004859ebd85531b8d5539f:1bfd3d3e4d9b85290d000fe25714b487:::

```

